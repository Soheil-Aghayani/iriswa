<!DOCTYPE html>
<html dir="rtl" lang="fa-IR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پورتال عضویت و استعلام | انجمن علمی مهندسی و مدیریت پسماند ایران</title>
    <link rel="stylesheet" href="./assets/css/main.css">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v3.3.0/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
</head>
<body>

    <header class="site-header">
    <div class="container header-inner">
        
        <div class="site-branding">
            <a href="/index.html" class="logo-link">
                <img src="./assets/images/logo.png" alt="لوگو انجمن مدیریت پسماند" class="site-logo">
            </a>
        </div>

        <nav class="main-nav">
            <ul class="nav-list">
                <li><a href="/about.html">درباره ما</a></li>
                <li><a href="/board.html">اعضای هیات مدیره</a></li>
                <li><a href="/news.html">اخبار</a></li>
                <li><a href="/courses.html">دوره‌ها و کارگاه‌ها</a></li>
                <li><a href="/sessions.html">نشست‌ها</a></li>
                <li><a href="/committees.html">کمیته‌های اصلی</a></li>
                
                <li class="has-dropdown">
                    <a href="/waste-management.html">مدیریت پسماند <span class="dropdown-arrow">&#9662;</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/waste-law.html">قانون مدیریت پسماندها</a></li>
                        <li><a href="/waste-technology.html">فناوری‌های مدیریت پسماند</a></li>
                        <li><a href="/waste-companies.html">شرکت‌های مدیریت پسماند</a></li>
                        <li><a href="/integrated-system.html">سیستم یکپارچه</a></li>
                    </ul>
                </li>
                
                <li><a href="/publications.html">انتشارات</a></li>
                <li><a href="/conferences.html">کنفرانس‌ها</a></li>
                <li><a href="/branches.html">شعب استانی</a></li>
                <li><a href="/membership.html">عضویت</a></li>
                <li><a href="/contact.html">ارتباط با ما</a></li>
            </ul>
        </nav>

        <div class="header-actions">
            <form action="/search.html" method="get" class="search-form">
                <input type="text" name="q" placeholder="جستجو در سایت..." class="search-input" aria-label="جستجو" autocomplete="off">
                <button type="submit" class="search-btn" aria-label="شروع جستجو">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </form>

            <button class="mobile-menu-toggle" aria-label="باز کردن منو" aria-expanded="false">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>

    </div>
</header>

    <main id="main-content">
        
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css" />
    
    <style>
        .membership-wrap {
            direction: rtl;
            font-family: 'Vazirmatn', Tahoma, sans-serif !important;
            background: #f8fafc;
            padding: 60px 20px;
            min-height: 80vh;
        }
        .portal-container {
            max-width: 900px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(11, 59, 38, 0.08);
            overflow: hidden;
        }
        
        /* Tabs Header */
        .tabs-header {
            display: flex;
            background: #e2e8f0;
            border-bottom: 2px solid #cbd5e1;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 200px;
            padding: 20px 10px;
            border: none;
            background: transparent;
            font-family: 'Vazirmatn', Tahoma, sans-serif !important;
            font-size: 1.15rem;
            font-weight: 900;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            background: #ffffff;
            color: var(--color-primary);
            box-shadow: inset 0 4px 0 var(--color-primary);
        }
        .tab-btn:hover:not(.active) {
            background: #f1f5f9;
            color: var(--color-dark);
        }

        .tab-content {
            display: none;
            padding: 40px 50px;
            animation: fadeIn 0.4s ease;
        }
        .tab-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Controls */
        .input-group { margin-bottom: 25px; text-align: right; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--color-dark); }
        .input-control {
            width: 100%; padding: 15px 20px; border: 2px solid #e2e8f0; border-radius: 12px;
            font-family: 'Vazirmatn', Tahoma, sans-serif !important; font-size: 1.05rem; transition: all 0.3s ease; background: #f8fafc;
        }
        .input-control:focus { border-color: var(--color-primary); background: #ffffff; outline: none; box-shadow: 0 0 0 4px rgba(11, 59, 38, 0.1); }
        
        /* Custom Mobile Input with Lipis Flag Icons */
        .mobile-wrapper { display: flex; direction: ltr; align-items: stretch; }
        .country-select-container {
            display: flex;
            align-items: center;
            background: #e2e8f0;
            border-radius: 12px 0 0 12px;
            padding: 0 15px;
            border: 2px solid #e2e8f0;
            border-right: none;
            position: relative;
        }
        .country-select-container .fi {
            font-size: 1.4rem;
            border-radius: 3px;
        }
        .country-select-container select {
            border: none;
            background: transparent;
            font-family: 'Vazirmatn', Tahoma, sans-serif !important;
            font-weight: bold;
            font-size: 1rem;
            margin-left: 8px;
            outline: none;
            cursor: pointer;
            color: var(--color-dark);
            direction: rtl; 
        }
        .mobile-input {
            border-radius: 0 12px 12px 0;
            flex: 1;
            text-align: left;
            direction: ltr;
        }

        /* Buttons */
        .btn-group { display: flex; justify-content: space-between; margin-top: 40px; border-top: 1px solid #e2e8f0; padding-top: 30px; }
        .btn {
            padding: 12px 30px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; 
            font-family: 'Vazirmatn', Tahoma, sans-serif !important;
            cursor: pointer; border: none; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-prev { background: #e2e8f0; color: #475569; }
        .btn-prev:hover { background: #cbd5e1; }
        .btn-next, .btn-submit { background: var(--color-primary); color: #ffffff; }
        .btn-next:hover, .btn-submit:hover:not(:disabled) { background: #082f1d; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(11, 59, 38, 0.2); }
        .btn-submit:disabled { background: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Payment Box */
        .payment-box { background: #f0f9ff; border: 2px dashed #0284c7; border-radius: 16px; padding: 25px; text-align: center; margin-bottom: 25px; transition: all 0.3s ease; }
        .payment-box h4 { color: #0369a1; margin: 0 0 10px 0; font-size: 1.3rem; }
        .payment-box p { margin: 5px 0; font-size: 1.1rem; }
        .payment-box .card-number { font-size: 1.8rem; font-weight: 900; letter-spacing: 2px; color: #104e8b; margin: 15px 0; direction: ltr; font-family: 'Vazirmatn', Tahoma, sans-serif !important; }

        /* Success/Error Modals */
        .alert-box { display: none; padding: 20px; border-radius: 12px; margin-top: 20px; text-align: center; font-weight: bold; font-size: 1.1rem; }
        .alert-success { background: #dcfce7; border: 1px solid #bbf7d0; color: #166534; }
        .alert-error { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; }

        /* Status Result Box */
        .status-card { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 16px; padding: 30px; margin-top: 30px; display: none; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .status-item { background: #ffffff; padding: 15px; border-radius: 12px; border: 1px solid #f1f5f9; }
        .status-item span { display: block; font-size: 0.9rem; color: #64748b; margin-bottom: 5px; }
        .status-item strong { font-size: 1.2rem; color: var(--color-dark); font-weight: 900; }
        
        .loading-spinner { display: none; text-align: center; margin-top: 20px; color: var(--color-primary); font-weight: bold; }

        @media only screen and (max-width: 600px) {
            .tab-content { padding: 30px 20px; }
            .status-grid { grid-template-columns: 1fr; }
        }
    </style>

    <section class="membership-wrap">
        <div class="portal-container">
            
            <div class="tabs-header">
                <button class="tab-btn active" onclick="switchTab('individual')">عضویت حقیقی (افراد)</button>
                <button class="tab-btn" onclick="switchTab('corporate')">عضویت حقوقی (شرکت‌ها)</button>
                <button class="tab-btn" onclick="switchTab('status')">پیگیری وضعیت ثبت‌نام</button>
            </div>

            <div id="tab-individual" class="tab-content active">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: var(--color-primary); margin: 0 0 10px;">درخواست عضویت حقیقی</h2>
                    <p style="color: #64748b; margin:0;">جهت پیوستن به انجمن، فرم زیر را در ۳ مرحله تکمیل نمایید.</p>
                </div>

                <form id="ind-form" enctype="multipart/form-data">
                    <input type="hidden" name="access_key" value="0ddc649f-6c8e-4e32-810e-cb92ea65f7bf">
                    <input type="hidden" name="subject" value="درخواست عضویت حقیقی جدید">
                    
                    <div id="ind-step-1" class="form-step active">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div class="input-group">
                                <label>نام و نام خانوادگی (فقط فارسی) *</label>
                                <input type="text" name="نام" class="input-control" required oninput="validatePersian(this)">
                            </div>
                            <div class="input-group">
                                <label>کد ملی (۱۰ رقم) *</label>
                                <input type="text" name="کد_ملی" class="input-control" required maxlength="10" placeholder="۰۰۱۲۳۴۵۶۷۸" oninput="formatNationalId(this)">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div class="input-group">
                                <label>شماره موبایل *</label>
                                <div class="mobile-wrapper">
                                    <div class="country-select-container">
                                        <span id="flag-ind" class="fi fi-ir"></span>
                                        <select name="کد_کشور" onchange="document.getElementById('flag-ind').className = 'fi fi-' + this.options[this.selectedIndex].getAttribute('data-cc')">
                                            <option value="+98" data-cc="ir">ایران (+۹۸)</option>
                                            <option value="+1" data-cc="us">آمریکا (+۱)</option>
                                            <option value="+1" data-cc="ca">کانادا (+۱)</option>
                                            <option value="+44" data-cc="gb">انگلیس (+۴۴)</option>
                                            <option value="+49" data-cc="de">آلمان (+۴۹)</option>
                                            <option value="+33" data-cc="fr">فرانسه (+۳۳)</option>
                                            <option value="+90" data-cc="tr">ترکیه (+۹۰)</option>
                                            <option value="+971" data-cc="ae">امارات (+۹۷۱)</option>
                                            <option value="+964" data-cc="iq">عراق (+۹۶۴)</option>
                                            <option value="+61" data-cc="au">استرالیا (+۶۱)</option>
                                        </select>
                                    </div>
                                    <input type="text" name="موبایل" class="input-control mobile-input" required placeholder="۹۱۲۰۵۴۳۵۸۷" oninput="formatMobile(this)">
                                </div>
                            </div>
                            <div class="input-group">
                                <label>ایمیل *</label>
                                <input type="email" name="ایمیل" class="input-control" dir="ltr" style="text-align:left;" required>
                            </div>
                        </div>
                        <div class="btn-group" style="justify-content: flex-end;">
                            <button type="button" class="btn btn-next" onclick="nextStep('ind', 1)">مرحله بعدی &larr;</button>
                        </div>
                    </div>

                    <div id="ind-step-2" class="form-step" style="display:none;">
                        <div class="input-group">
                            <label>وضعیت تحصیلی *</label>
                            <select id="edu_status" name="وضعیت_تحصیلی" class="input-control" required onchange="handleStudentStatus()">
                                <option value="" disabled selected>انتخاب کنید...</option>
                                <option value="فارغ التحصیل">فارغ‌التحصیل / شاغل</option>
                                <option value="دانشجو">دانشجو (در حال تحصیل)</option>
                            </select>
                        </div>
                        
                        <div id="student-fields" style="display:none; background: #fffbeb; padding: 20px; border-radius: 12px; border: 1px solid #fde047; margin-bottom: 25px;">
                            <div class="input-group">
                                <label style="color: #a16207;">مقطع دانشجویی *</label>
                                <select id="student_level" name="مقطع_دانشجویی" class="input-control" style="background: #fff;" onchange="handleStudentStatus()">
                                    <option value="" disabled selected>انتخاب مقطع...</option>
                                    <option value="دانشجوی کاردانی">دانشجوی کاردانی</option>
                                    <option value="دانشجوی کارشناسی">دانشجوی کارشناسی</option>
                                    <option value="دانشجوی کارشناسی ارشد">دانشجوی کارشناسی ارشد</option>
                                    <option value="دانشجوی دکتری تخصصی">دانشجوی دکتری تخصصی</option>
                                    <option value="دانشجوی پست دکتری">دانشجوی پست دکتری</option>
                                </select>
                            </div>
                            <div class="input-group" style="margin-bottom:0;">
                                <label style="color: #a16207;">تصویر کارت دانشجویی معتبر (حداکثر ۲ مگابایت) *</label>
                                <input type="file" id="student_card_img" name="کارت_دانشجویی" class="input-control" accept="image/*,.pdf" style="background: #fff;">
                            </div>
                        </div>

                        <div id="grad-fields" style="display:none;">
                            <div class="input-group">
                                <label>آخرین مقطع فارغ‌التحصیلی *</label>
                                <select id="grad_level" name="مقطع_فارغ_التحصیلی" class="input-control" onchange="handleStudentStatus()">
                                    <option value="" disabled selected>انتخاب مقطع...</option>
                                    <option value="دیپلم">دیپلم</option>
                                    <option value="کاردانی">کاردانی</option>
                                    <option value="کارشناسی">کارشناسی</option>
                                    <option value="کارشناسی ارشد">کارشناسی ارشد</option>
                                    <option value="دکتری تخصصی">دکتری تخصصی</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div class="input-group">
                                <label>رشته تحصیلی *</label>
                                <input type="text" name="رشته_تحصیلی" class="input-control" required>
                            </div>
                            <div class="input-group">
                                <label>سمت / شغل *</label>
                                <input type="text" id="job_title_input" name="سمت_شغل" class="input-control" required>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep('ind', 2)">&rarr; مرحله قبلی</button>
                            <button type="button" class="btn btn-next" onclick="nextStep('ind', 2)">مرحله بعدی &larr;</button>
                        </div>
                    </div>

                    <div id="ind-step-3" class="form-step" style="display:none;">
                        
                        <div class="payment-box" id="dynamic-payment-box">
                            <h4>مبلغ قابل پرداخت حق عضویت</h4>
                            <p id="fee-text" style="font-weight:bold; color: #dc2626; font-size: 1.2rem;">لطفاً ابتدا در مرحله قبل وضعیت و مقطع تحصیلی خود را مشخص کنید.</p>
                            <div class="card-number">۵۸۵۹ - ۸۳۷۰ - ۲۴۲۶ - ۵۵۳۶</div>
                            <p style="color:#0c4a6e;">بانک تجارت | به نام: انجمن علمی مدیریت پسماند ایران</p>
                        </div>

                        <div class="input-group">
                            <label>آپلود تصویر فیش واریزی (حداکثر ۲ مگابایت) *</label>
                            <input type="file" name="فیش_واریزی" class="input-control" accept="image/*,.pdf" required>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div class="input-group">
                                <label>تصویر کارت ملی (حداکثر ۲ مگابایت) *</label>
                                <input type="file" name="تصویر_کارت_ملی" class="input-control" accept="image/*,.pdf" required>
                            </div>
                            <div class="input-group">
                                <label>عکس پرسنلی ۳×۴ (حداکثر ۲ مگابایت) *</label>
                                <input type="file" name="عکس_پرسنلی" class="input-control" accept="image/*" required>
                            </div>
                        </div>

                        <div id="ind-alert-error" class="alert-box alert-error"></div>
                        <div id="ind-alert-success" class="alert-box alert-success">فرم شما با موفقیت ارسال شد. نتیجه ثبت‌نام به زودی اطلاع‌رسانی خواهد شد.</div>

                        <div class="btn-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep('ind', 3)">&rarr; مرحله قبلی</button>
                            <button type="submit" id="ind-submit-btn" class="btn btn-submit">ارسال مدارک و درخواست عضویت</button>
                        </div>
                    </div>
                </form>
            </div>

            <div id="tab-corporate" class="tab-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #104e8b; margin: 0 0 10px;">عضویت حقوقی (سازمان‌ها و شرکت‌ها)</h2>
                    <p style="color: #64748b; margin:0;">بهره‌مندی از ظرفیت‌های علمی، پژوهشی و شبکه‌سازی تخصصی</p>
                </div>

                <form id="corp-form" enctype="multipart/form-data">
                    <input type="hidden" name="access_key" value="0ddc649f-6c8e-4e32-810e-cb92ea65f7bf">
                    <input type="hidden" name="subject" value="درخواست عضویت حقوقی شرکت">
                    
                    <div class="payment-box" style="border-color: #104e8b; background: #f0f9ff;">
                        <h4 style="color: #104e8b;">حق عضویت سالیانه حقوقی</h4>
                        <p style="font-size: 1.4rem; font-weight: 900; color: #0c4a6e;">۵۰,۰۰۰,۰۰۰ ریال</p>
                        <div class="card-number">۵۸۵۹ - ۸۳۷۰ - ۲۴۲۶ - ۵۵۳۶</div>
                        <p style="color:#0c4a6e;">بانک تجارت | به نام: انجمن علمی مدیریت پسماند ایران</p>
                    </div>

                    <h3 style="color: #104e8b; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-bottom: 20px;">مشخصات ثبتی شرکت</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div class="input-group"><label>نام کامل شرکت *</label><input type="text" name="نام_شرکت" class="input-control" required></div>
                        <div class="input-group"><label>نوع شرکت *</label><select name="نوع_شرکت" class="input-control" required><option value="سهامی خاص">سهامی خاص</option><option value="سهامی عام">سهامی عام</option><option value="مسئولیت محدود">مسئولیت محدود</option><option value="سایر">سایر</option></select></div>
                        <div class="input-group"><label>نام مدیرعامل *</label><input type="text" name="مدیرعامل" class="input-control" required></div>
                        <div class="input-group"><label>حوزه فعالیت *</label><input type="text" name="حوزه_فعالیت" class="input-control" required></div>
                        <div class="input-group"><label>تاریخ آخرین آگهی روزنامه رسمی *</label><input type="text" name="تاریخ_آگهی" class="input-control" placeholder="مثال: ۱۴۰۲/۰۵/۱۲" required oninput="formatNationalId(this)"></div>
                        <div class="input-group"><label>آپلود آگهی روزنامه رسمی (حداکثر ۲ مگابایت) *</label><input type="file" name="فایل_روزنامه" class="input-control" accept=".pdf,image/*" required></div>
                    </div>

                    <h3 style="color: #104e8b; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-bottom: 20px; margin-top: 20px;">اطلاعات تماس و رابط</h3>
                    <div class="input-group"><label>آدرس دقیق پستی *</label><input type="text" name="آدرس" class="input-control" required></div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div class="input-group"><label>کد پستی *</label><input type="text" name="کدپستی" class="input-control" required oninput="formatNationalId(this)"></div>
                        <div class="input-group"><label>تلفن ثابت شرکت *</label><input type="text" name="تلفن_شرکت" class="input-control" dir="ltr" style="text-align:left;" required oninput="formatMobile(this)"></div>
                        <div class="input-group"><label>نام و نام خانوادگی رابط *</label><input type="text" name="نام_رابط" class="input-control" required oninput="validatePersian(this)"></div>
                        
                        <div class="input-group">
                            <label>شماره همراه رابط *</label>
                            <div class="mobile-wrapper">
                                <div class="country-select-container">
                                    <span id="flag-corp" class="fi fi-ir"></span>
                                    <select name="کد_کشور" onchange="document.getElementById('flag-corp').className = 'fi fi-' + this.options[this.selectedIndex].getAttribute('data-cc')">
                                        <option value="+98" data-cc="ir">ایران (+۹۸)</option>
                                        <option value="+1" data-cc="us">آمریکا (+۱)</option>
                                        <option value="+1" data-cc="ca">کانادا (+۱)</option>
                                        <option value="+44" data-cc="gb">انگلیس (+۴۴)</option>
                                        <option value="+49" data-cc="de">آلمان (+۴۹)</option>
                                        <option value="+33" data-cc="fr">فرانسه (+۳۳)</option>
                                        <option value="+90" data-cc="tr">ترکیه (+۹۰)</option>
                                        <option value="+971" data-cc="ae">امارات (+۹۷۱)</option>
                                        <option value="+964" data-cc="iq">عراق (+۹۶۴)</option>
                                        <option value="+61" data-cc="au">استرالیا (+۶۱)</option>
                                    </select>
                                </div>
                                <input type="text" name="موبایل_رابط" class="input-control mobile-input" required placeholder="۹۱۲۰۵۴۳۵۸۷" oninput="formatMobile(this)">
                            </div>
                        </div>

                        <div class="input-group"><label>ایمیل رابط *</label><input type="email" name="ایمیل_رابط" class="input-control" dir="ltr" style="text-align:left;" required></div>
                        <div class="input-group"><label>آپلود فیش واریزی (حداکثر ۲ مگابایت) *</label><input type="file" name="فیش_واریزی_حقوقی" class="input-control" accept=".pdf,image/*" required></div>
                    </div>

                    <div id="corp-alert-error" class="alert-box alert-error"></div>
                    <div id="corp-alert-success" class="alert-box alert-success">درخواست حقوقی شما با موفقیت ثبت شد. جهت هماهنگی تماس گرفته خواهد شد.</div>

                    <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                        <button type="submit" id="corp-submit-btn" class="btn btn-submit" style="width: 100%; max-width: 400px; background: #104e8b;">ثبت‌نام حقوقی و ارسال مدارک</button>
                    </div>
                </form>
            </div>

            <div id="tab-status" class="tab-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: var(--color-dark); margin: 0 0 10px;">استعلام وضعیت ثبت‌نام و کارت عضویت</h2>
                    <p style="color: #64748b; margin:0;">کد ملی و شماره موبایل خود را جهت مشاهده آخرین وضعیت وارد کنید.</p>
                </div>

                <div style="background: #f8fafc; padding: 30px; border-radius: 16px; border: 1px solid #e2e8f0; max-width: 500px; margin: 0 auto;">
                    <div class="input-group">
                        <label>کد ملی (۱۰ رقم)</label>
                        <input type="text" id="check_nid" class="input-control" maxlength="10" placeholder="۰۰۱۲۳۴۵۶۷۸" oninput="formatNationalId(this)">
                    </div>
                    <div class="input-group">
                        <label>شماره موبایل ثبت نامی</label>
                        <input type="text" id="check_phone" class="input-control" dir="ltr" style="text-align:left;" placeholder="۹۱۲۰۵۴۳۵۸۷" oninput="formatMobile(this)">
                    </div>
                    <button type="button" class="btn btn-submit" style="width: 100%;" onclick="checkMembershipStatus()">بررسی وضعیت من</button>
                    <div id="loading-status" class="loading-spinner">در حال ارتباط با سرور امن انجمن...</div>
                </div>

                <div id="status-result" class="status-card">
                    <h3 style="text-align: center; color: var(--color-primary); margin-top:0;">نتیجه استعلام</h3>
                    <div class="status-grid">
                        <div class="status-item"><span>نام و نام خانوادگی:</span><strong id="res_name">-</strong></div>
                        <div class="status-item"><span>شماره عضویت:</span><strong id="res_id">-</strong></div>
                        <div class="status-item"><span>نوع عضویت:</span><strong id="res_type">-</strong></div>
                        <div class="status-item"><span>مقطع تحصیلی:</span><strong id="res_edu">-</strong></div>
                        <div class="status-item"><span>وضعیت عکس پرسنلی:</span><strong id="res_pic">-</strong></div>
                        <div class="status-item"><span>زمان باقی‌مانده اعتبار (روز):</span><strong id="res_time" style="color:#ea580c;">-</strong></div>
                    </div>
                    <div style="margin-top: 20px; background: #e0f2fe; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #bae6fd;">
                        <span style="display: block; color: #0369a1; font-size: 0.9rem; margin-bottom: 5px;">وضعیت صدور کارت عضویت:</span>
                        <strong id="res_card" style="font-size: 1.4rem; color: #0c4a6e; font-weight: 900;">-</strong>
                    </div>
                </div>
                
                <div id="status-error" style="display:none; background: #fef2f2; color: #991b1b; padding: 20px; border-radius: 12px; border: 1px solid #fecaca; text-align: center; margin-top: 30px; max-width: 500px; margin-left: auto; margin-right: auto;">
                    اطلاعاتی با این کد ملی و شماره موبایل یافت نشد. لطفاً از صحت اطلاعات وارد شده اطمینان حاصل کنید.
                </div>
            </div>

        </div>
    </section>

    <script>
        // --- Tab Switching Logic ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        // --- Multi-Step Form Logic ---
        function nextStep(formType, current) {
            document.getElementById(`${formType}-step-${current}`).style.display = 'none';
            document.getElementById(`${formType}-step-${current + 1}`).style.display = 'block';
        }
        function prevStep(formType, current) {
            document.getElementById(`${formType}-step-${current}`).style.display = 'none';
            document.getElementById(`${formType}-step-${current - 1}`).style.display = 'block';
        }

        // --- Validation & Persian Digits Formatting Logic ---
        const persianDigits = '۰۱۲۳۴۵۶۷۸۹';
        const englishDigits = '0123456789';

        function toEnglishDigits(str) {
            if (!str) return '';
            return str.toString().replace(/[۰-۹]/g, w => englishDigits[persianDigits.indexOf(w)]);
        }
        function toPersianDigits(str) {
            if (!str) return '';
            return str.toString().replace(/\d/g, d => persianDigits[d]);
        }

        function formatNationalId(input) {
            let val = toEnglishDigits(input.value);
            val = val.replace(/[^0-9]/g, ''); 
            input.value = toPersianDigits(val);
        }

        function formatMobile(input) {
            let val = toEnglishDigits(input.value);
            val = val.replace(/[^0-9]/g, ''); 
            if(val.length === 11 && val.startsWith('0')) { val = val.substring(1); }
            if(val.length > 10) val = val.slice(0, 10);
            input.value = toPersianDigits(val);
        }

        function validatePersian(input) {
            input.value = input.value.replace(/[^؀-ۿ\s]/g, '');
        }

        // --- Student Status & Dynamic Auto-fill Logic ---
        function handleStudentStatus() {
            const status = document.getElementById('edu_status').value;
            const studentFields = document.getElementById('student-fields');
            const gradFields = document.getElementById('grad-fields');
            const feeText = document.getElementById('fee-text');
            const paymentBox = document.getElementById('dynamic-payment-box');
            
            const studentSelect = document.getElementById('student_level');
            const studentCard = document.getElementById('student_card_img');
            const gradSelect = document.getElementById('grad_level');
            const jobInput = document.getElementById('job_title_input'); // Target for auto-fill

            if(status === 'دانشجو') {
                studentFields.style.display = 'block';
                gradFields.style.display = 'none';
                studentSelect.setAttribute('required', 'true');
                studentCard.setAttribute('required', 'true');
                gradSelect.removeAttribute('required');
                
                // Auto-fill Job as "دانشجو"
                jobInput.value = 'دانشجو';
                
                paymentBox.style.borderColor = '#eab308';
                feeText.innerHTML = `مبلغ قابل پرداخت (حق عضویت دانشجویی): ${toPersianDigits('500,000')} ریال`;
                feeText.style.color = '#ca8a04';

            } else if(status === 'فارغ التحصیل') {
                studentFields.style.display = 'none';
                gradFields.style.display = 'block';
                studentSelect.removeAttribute('required');
                studentCard.removeAttribute('required');
                gradSelect.setAttribute('required', 'true');

                // Clear the auto-filled "دانشجو" if they switch to Graduated
                if(jobInput.value === 'دانشجو') {
                    jobInput.value = '';
                }

                const level = gradSelect.value;
                if(level === 'کارشناسی ارشد' || level === 'دکتری تخصصی') {
                    paymentBox.style.borderColor = '#16a34a';
                    feeText.innerHTML = `مبلغ قابل پرداخت (عضویت پیوسته): ${toPersianDigits('2,500,000')} ریال`;
                    feeText.style.color = '#15803d';
                } else if(level === 'دیپلم' || level === 'کاردانی' || level === 'کارشناسی') {
                    paymentBox.style.borderColor = '#0284c7';
                    feeText.innerHTML = `مبلغ قابل پرداخت (عضویت وابسته): ${toPersianDigits('1,500,000')} ریال`;
                    feeText.style.color = '#0369a1';
                } else {
                    paymentBox.style.borderColor = '#ef4444';
                    feeText.innerHTML = 'لطفاً مقطع تحصیلی خود را جهت محاسبه دقیق حق عضویت انتخاب کنید.';
                    feeText.style.color = '#b91c1c';
                }
            }
        }

        // --- AJAX Form Submission ---
        function setupAjaxForm(formId, btnId, errId, sucId) {
            const form = document.getElementById(formId);
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const errBox = document.getElementById(errId);
                const sucBox = document.getElementById(sucId);
                const submitBtn = document.getElementById(btnId);
                errBox.style.display = 'none';
                sucBox.style.display = 'none';

                // File Size Validation (Max 2MB per file)
                const fileInputs = form.querySelectorAll('input[type="file"]');
                const maxSize = 2 * 1024 * 1024; // 2MB
                for (let fileInput of fileInputs) {
                    if (fileInput.files.length > 0 && fileInput.files[0].size > maxSize) {
                        errBox.innerText = 'خطا: حجم فایل انتخابی بیشتر از ۲ مگابایت است. لطفاً فایل کم‌حجم‌تری انتخاب کنید.';
                        errBox.style.display = 'block';
                        return;
                    }
                }

                const formData = new FormData(form);
                
                // UX: Show loading spinner
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="4.93" x2="19.07" y2="7.76"></line></svg> در حال ارسال...';
                
                if(!document.getElementById('spin-anim')) {
                    const style = document.createElement('style');
                    style.id = 'spin-anim';
                    style.innerHTML = `@keyframes spin { 100% { transform: rotate(360deg); } }`;
                    document.head.appendChild(style);
                }

                fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    body: formData
                })
                .then(async (response) => {
                    let json = await response.json();
                    if (response.status == 200) {
                        sucBox.style.display = 'block';
                        form.reset();
                        if(formId === 'ind-form') {
                            document.getElementById('student-fields').style.display = 'none';
                            document.getElementById('grad-fields').style.display = 'none';
                            document.getElementById('fee-text').innerHTML = 'لطفاً ابتدا در مرحله قبل وضعیت و مقطع تحصیلی خود را مشخص کنید.';
                            document.getElementById('dynamic-payment-box').style.borderColor = '#0284c7';
                        }
                    } else {
                        errBox.innerText = json.message || "خطا در ارسال فرم. لطفاً مجدداً تلاش کنید.";
                        errBox.style.display = 'block';
                    }
                })
                .catch(error => {
                    errBox.innerText = "ارتباط با سرور برقرار نشد. لطفاً اینترنت خود را بررسی کنید.";
                    errBox.style.display = 'block';
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'ارسال مدارک و درخواست عضویت';
                });
            });
        }

        setupAjaxForm('ind-form', 'ind-submit-btn', 'ind-alert-error', 'ind-alert-success');
        setupAjaxForm('corp-form', 'corp-submit-btn', 'corp-alert-error', 'corp-alert-success');


        // --- Secure Apps Script Fetch Logic ---
        async function checkMembershipStatus() {
            let nid_fa = document.getElementById('check_nid').value;
            let phone_fa = document.getElementById('check_phone').value;
            
            let nid = toEnglishDigits(nid_fa);
            let phone = toEnglishDigits(phone_fa);
            
            if(nid.length < 10 || phone.length < 10) {
                alert("لطفاً کد ملی و شماره موبایل را به صورت کامل وارد کنید.");
                return;
            }

            if(phone.length === 11 && phone.startsWith('0')) phone = phone.substring(1);

            document.getElementById('loading-status').style.display = 'block';
            document.getElementById('status-result').style.display = 'none';
            document.getElementById('status-error').style.display = 'none';

            // YOUR SECURE GOOGLE APPS SCRIPT WEB APP URL
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxRRkJURuqzYKdUFwrgHM09NGGkgVo7j75GXNoy-ntXMMNcmPvaCwxRzwJfj0Q32BnE/exec';
            
            const fetchUrl = `${scriptUrl}?nid=${encodeURIComponent(nid)}&phone=${encodeURIComponent(phone)}`;

            try {
                const response = await fetch(fetchUrl);
                const result = await response.json();

                if(result.status === "success") {
                    document.getElementById('res_id').innerText = toPersianDigits(result.data.id);
                    document.getElementById('res_name').innerText = toPersianDigits(result.data.name);
                    document.getElementById('res_pic').innerText = toPersianDigits(result.data.pic);
                    document.getElementById('res_type').innerText = toPersianDigits(result.data.type);
                    document.getElementById('res_edu').innerText = toPersianDigits(result.data.edu);
                    document.getElementById('res_card').innerText = toPersianDigits(result.data.card);
                    document.getElementById('res_time').innerText = toPersianDigits(result.data.time);
                    
                    document.getElementById('loading-status').style.display = 'none';
                    document.getElementById('status-result').style.display = 'block';
                } else {
                    document.getElementById('loading-status').style.display = 'none';
                    document.getElementById('status-error').style.display = 'block';
                }
            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('loading-status').style.display = 'none';
                alert("خطا در ارتباط با سرور. لطفاً اتصال اینترنت خود را بررسی کنید.");
            }
        }
    </script>
    
    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            
            <div class="footer-col">
                <h3>درباره انجمن علمی</h3>
                <p>انجمن علمی مهندسی و مدیریت پسماند ایران زیر نظر کمیسیون انجمن‌های علمی وزارت علوم، تحقیقات و فناوری، با حضور اساتید و مدیران برجسته کشور در سال ۱۳۹۰ تاسیس شده است.</p>
            </div>

            <div class="footer-col">
                <h3>دسترسی سریع</h3>
                <ul class="footer-links">
                    <li><a href="/index.html">خانه</a></li>
                    <li><a href="/about.html">درباره ما</a></li>
                    <li><a href="/news.html">اخبار و وبلاگ</a></li>
                    <li><a href="/contact.html">تماس با ما</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>ارتباط با ما</h3>
                <ul class="footer-links">
                    <li><strong>تلفن:</strong> <span style="direction: rtl; unicode-bidi: embed;">۰۲۱-۶۱۱۱۳۱۹۹</span></li>
                    <li><strong>ایمیل:</strong> anjomanpasmand@gmail.com</li>
                    <li><a href="https://t.me/anjomanpasmandiran" target="_blank" style="color: var(--color-secondary);">کانال تلگرام انجمن &rarr;</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>مراکز همکار</h3>
                <ul class="footer-links">
                    <li><a href="https://www.doe.ir/" target="_blank">سازمان حفاظت محیط‌زیست</a></li>
                    <li><a href="https://jpoll.ut.ac.ir/" target="_blank">ژورنال پلوشن</a></li>
                    <li><a href="https://jes.ut.ac.ir/" target="_blank">محیط‌شناسی</a></li>
                    <li><a href="https://www.landscapeecologyjournals.ir/" target="_blank">فصلنامه اکولوژی انسانی</a></li>
                </ul>
            </div>

        </div>
        
        <div class="footer-bottom">
            <p>© حقوق این وبسایت برای انجمن علمی مهندسی و مدیریت پسماند ایران محفوظ است.</p>
        </div>
    </div>
</footer>

    <script src="./assets/js/main.js"></script>
</body>
</html>